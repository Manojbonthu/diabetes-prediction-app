<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Diabetes Prediction System</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#1c1c1c; font-family:'Nunito',sans-serif; color:#222; min-height:100vh; }

  nav {
    background:#f5c518; padding:14px 32px;
    display:flex; align-items:center; justify-content:space-between;
    border-bottom:4px solid #d4a900;
  }
  nav .brand { font-size:1.25rem; font-weight:800; color:#1c1c1c; }
  nav .brand span { opacity:0.55; font-weight:600; font-size:0.85rem; margin-left:10px; }
  nav .tag {
    background:#1c1c1c; color:#f5c518;
    padding:5px 14px; border-radius:4px;
    font-size:0.75rem; font-weight:700; letter-spacing:0.5px;
  }

  .page { max-width:1080px; margin:32px auto; padding:0 20px 60px; }

  .heading { text-align:center; margin-bottom:32px; }
  .heading h2 { font-size:1.5rem; font-weight:800; color:#f5c518; margin-bottom:6px; }
  .heading p  { font-size:0.85rem; color:#888; }

  .layout {
    display:grid; grid-template-columns:360px 1fr;
    gap:24px; align-items:start;
  }

  .card { background:#262626; border:1px solid #333; border-radius:12px; padding:24px; }
  .card-head {
    font-size:0.72rem; font-weight:800; text-transform:uppercase;
    letter-spacing:1.5px; color:#f5c518; margin-bottom:18px;
    padding-bottom:10px; border-bottom:1px solid #333;
  }

  .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .field { display:flex; flex-direction:column; gap:5px; }
  label { font-size:0.68rem; font-weight:700; color:#999; text-transform:uppercase; letter-spacing:0.8px; }
  input {
    background:#1c1c1c; border:1.5px solid #383838; border-radius:7px;
    padding:9px 11px; color:#f0f0f0; font-family:'Nunito',sans-serif;
    font-size:0.88rem; outline:none; transition:border-color 0.18s;
  }
  input:focus { border-color:#f5c518; }

  .btn {
    width:100%; margin-top:18px; padding:12px;
    background:#f5c518; border:none; border-radius:8px;
    color:#1c1c1c; font-family:'Nunito',sans-serif;
    font-size:0.95rem; font-weight:800; cursor:pointer;
    transition:background 0.15s, transform 0.1s;
  }
  .btn:hover  { background:#e6b800; transform:translateY(-1px); }
  .btn:active { transform:translateY(0); }
  .btn:disabled { opacity:0.55; cursor:not-allowed; transform:none; }

  .right { display:flex; flex-direction:column; gap:18px; }

  .placeholder {
    background:#262626; border:2px dashed #383838;
    border-radius:12px; text-align:center; padding:56px 24px;
  }
  .placeholder .ico { font-size:2.8rem; margin-bottom:12px; }
  .placeholder p    { font-size:0.85rem; color:#666; line-height:1.7; }
  .placeholder strong { color:#f5c518; }

  .result-box { border-radius:12px; padding:20px 24px; display:none; }
  .result-box.diabetic { background:#2a1515; border:1.5px solid #c0392b; border-left:5px solid #c0392b; }
  .result-box.healthy  { background:#122015; border:1.5px solid #27ae60; border-left:5px solid #27ae60; }
  .result-micro  { font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:1.5px; color:#777; margin-bottom:5px; }
  .result-name   { font-size:1.9rem; font-weight:800; margin-bottom:4px; }
  .result-detail { font-size:0.8rem; color:#888; }

  .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:14px; }
  .stat {
    background:#262626; border:1px solid #333;
    border-radius:10px; padding:16px; display:none;
  }
  .stat-val { font-size:1.5rem; font-weight:800; margin-bottom:3px; }
  .stat-lbl { font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#666; }
  .bar-wrap  { margin-top:8px; background:#1c1c1c; border-radius:4px; height:5px; overflow:hidden; }
  .bar-fill  { height:100%; border-radius:4px; width:0%; transition:width 0.9s ease; }

  .charts { display:grid; grid-template-columns:1fr 1fr; gap:18px; }
  .chart-card { display:none; }

  .rec {
    background:#262626; border:1px solid #333;
    border-left:4px solid #f5c518; border-radius:10px;
    padding:18px 20px; display:none;
  }
  .rec-head { font-size:0.68rem; font-weight:800; text-transform:uppercase; letter-spacing:1.2px; color:#f5c518; margin-bottom:8px; }
  .rec-body { font-size:0.85rem; color:#ccc; line-height:1.75; }

  .spin {
    display:none; width:18px; height:18px;
    border:2px solid rgba(28,28,28,0.25);
    border-top-color:#1c1c1c; border-radius:50%;
    animation:rot 0.7s linear infinite; margin:0 auto;
  }
  @keyframes rot { to { transform:rotate(360deg); } }

  .error-box {
    background:#2a1515; border:1.5px solid #c0392b;
    border-radius:10px; padding:16px 20px; display:none;
    font-size:0.85rem; color:#e74c3c;
  }

  footer { text-align:center; padding:20px; font-size:0.75rem; color:#555; border-top:1px solid #2a2a2a; }

  @media(max-width:820px){
    .layout { grid-template-columns:1fr; }
    .stats  { grid-template-columns:1fr 1fr; }
    .charts { grid-template-columns:1fr; }
  }
</style>
</head>
<body>

<nav>
  <div class="brand">ðŸ©º DiabetesPredict <span>Fused ML System</span></div>
  <div class="tag">Academic Project â€” Vizag</div>
</nav>

<div class="page">
  <div class="heading">
    <h2>Diabetes Prediction Using Fused Machine Learning</h2>
    <p>SVM &nbsp;+&nbsp; Random Forest &nbsp;+&nbsp; KNN &nbsp;+&nbsp; Voting Classifier</p>
  </div>

  <div class="layout">

    <!-- INPUT FORM -->
    <div class="card">
      <div class="card-head">Patient Details</div>
      <div class="form-grid">
        <div class="field"><label>Pregnancies</label><input type="number" id="pregnancies" value="0" min="0" max="20"/></div>
        <div class="field"><label>Glucose (mg/dL)</label><input type="number" id="glucose" value="85" min="0" max="300"/></div>
        <div class="field"><label>Blood Pressure</label><input type="number" id="blood_pressure" value="70" min="0" max="200"/></div>
        <div class="field"><label>Skin Thickness</label><input type="number" id="skin_thickness" value="20" min="0" max="100"/></div>
        <div class="field"><label>Insulin (Î¼U/mL)</label><input type="number" id="insulin" value="80" min="0" max="900"/></div>
        <div class="field"><label>BMI</label><input type="number" id="bmi" value="22.5" min="0" max="70" step="0.1"/></div>
        <div class="field"><label>Diabetes Pedigree</label><input type="number" id="diabetes_pedigree" value="0.25" min="0" max="3" step="0.01"/></div>
        <div class="field"><label>Age</label><input type="number" id="age" value="30" min="1" max="120"/></div>
      </div>
      <button class="btn" id="predictBtn" onclick="runPrediction()">
        <span id="btnText">Run Prediction</span>
        <div class="spin" id="spinner"></div>
      </button>
    </div>

    <!-- RESULTS -->
    <div class="right">

      <div class="placeholder" id="placeholder">
        <div class="ico">ðŸ”¬</div>
        <p>Enter the patient details on the left<br>and click <strong>Run Prediction</strong> to see results.</p>
      </div>

      <div class="error-box" id="errorBox"></div>

      <div class="result-box" id="resultBox">
        <div class="result-micro">Prediction Result</div>
        <div class="result-name" id="resultName">â€”</div>
        <div class="result-detail" id="resultDetail">â€”</div>
      </div>

      <div class="stats">
        <div class="stat" id="s1">
          <div class="stat-val" id="v1" style="color:#e74c3c">â€”</div>
          <div class="stat-lbl">Diabetic Probability</div>
        </div>
        <div class="stat" id="s2">
          <div class="stat-val" id="v2">â€”</div>
          <div class="stat-lbl">Risk Score</div>
          <div class="bar-wrap"><div class="bar-fill" id="barFill"></div></div>
        </div>
        <div class="stat" id="s3">
          <div class="stat-val" id="v3" style="color:#27ae60">â€”</div>
          <div class="stat-lbl">Non-Diabetic Prob.</div>
        </div>
      </div>

      <div class="charts">
        <div class="card chart-card" id="cc1">
          <div class="card-head">Confidence Split</div>
          <canvas id="dChart"></canvas>
        </div>
        <div class="card chart-card" id="cc2">
          <div class="card-head">Model Comparison</div>
          <canvas id="bChart"></canvas>
        </div>
      </div>

      <div class="rec" id="rec">
        <div class="rec-head">ðŸ’¡ Health Recommendation</div>
        <div class="rec-body" id="recBody">â€”</div>
      </div>

    </div>
  </div>
</div>

<footer>Diabetes Prediction System &mdash; Academic Project &mdash; Vizag, Andhra Pradesh</footer>

<script>
let dc = null, bc = null;

async function runPrediction() {
  const btn = document.getElementById('predictBtn');
  document.getElementById('btnText').style.display = 'none';
  document.getElementById('spinner').style.display = 'block';
  document.getElementById('errorBox').style.display = 'none';
  btn.disabled = true;

  const payload = {
    pregnancies:       document.getElementById('pregnancies').value,
    glucose:           document.getElementById('glucose').value,
    blood_pressure:    document.getElementById('blood_pressure').value,
    skin_thickness:    document.getElementById('skin_thickness').value,
    insulin:           document.getElementById('insulin').value,
    bmi:               document.getElementById('bmi').value,
    diabetes_pedigree: document.getElementById('diabetes_pedigree').value,
    age:               document.getElementById('age').value,
  };

  try {
    const res = await fetch('/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const text = await res.text();
      throw new Error('Server error ' + res.status + ': ' + text);
    }

    const data = await res.json();
    displayResults(data);

  } catch (e) {
    console.error(e);
    const eb = document.getElementById('errorBox');
    eb.textContent = 'âš ï¸ ' + e.message;
    eb.style.display = 'block';
    document.getElementById('placeholder').style.display = 'none';
  } finally {
    btn.disabled = false;
    document.getElementById('btnText').style.display = 'block';
    document.getElementById('spinner').style.display  = 'none';
  }
}

function displayResults(r) {
  document.getElementById('placeholder').style.display = 'none';

  // Banner
  const isDiabetic = r.prediction === 'Diabetic';
  const box = document.getElementById('resultBox');
  box.className    = 'result-box ' + (isDiabetic ? 'diabetic' : 'healthy');
  box.style.display = 'block';
  const nameEl = document.getElementById('resultName');
  nameEl.textContent = r.prediction;
  nameEl.style.color = isDiabetic ? '#e74c3c' : '#2ecc71';
  document.getElementById('resultDetail').textContent =
    'Confidence: ' + Math.max(r.probability_diabetic, r.probability_non_diabetic) +
    '%  |  Risk Level: ' + r.risk_label;

  // Stats
  ['s1','s2','s3'].forEach(id => document.getElementById(id).style.display = 'block');
  document.getElementById('v1').textContent = r.probability_diabetic + '%';
  document.getElementById('v3').textContent = r.probability_non_diabetic + '%';
  document.getElementById('v2').textContent = r.risk_score + '%';

  const fill = document.getElementById('barFill');
  fill.style.width      = r.risk_score + '%';
  fill.style.background = r.risk_label === 'Low' ? '#27ae60' : r.risk_label === 'Medium' ? '#f5c518' : '#e74c3c';
  document.getElementById('v2').style.color = fill.style.background;

  // Charts
  document.getElementById('cc1').style.display = 'block';
  document.getElementById('cc2').style.display = 'block';

  // Doughnut chart
  if (dc) dc.destroy();
  dc = new Chart(document.getElementById('dChart'), {
    type: 'doughnut',
    data: {
      labels: ['Diabetic', 'Non-Diabetic'],
      datasets: [{
        data: [r.probability_diabetic, r.probability_non_diabetic],
        backgroundColor: ['#e74c3c', '#27ae60'],
        borderColor: '#262626',
        borderWidth: 4
      }]
    },
    options: {
      cutout: '62%',
      plugins: {
        legend: { position:'bottom', labels:{ color:'#888', font:{size:11}, padding:14 } }
      }
    }
  });

  // Bar chart â€” uses model_scores from Flask
  if (bc) bc.destroy();
  const models = Object.keys(r.model_scores);
  const scores = Object.values(r.model_scores);
  bc = new Chart(document.getElementById('bChart'), {
    type: 'bar',
    data: {
      labels: models,
      datasets: [{
        data: scores,
        backgroundColor: scores.map(s => s >= 50 ? 'rgba(231,76,60,0.8)' : 'rgba(39,174,96,0.8)'),
        borderColor:      scores.map(s => s >= 50 ? '#e74c3c' : '#27ae60'),
        borderWidth: 1.5,
        borderRadius: 6,
        borderSkipped: false
      }]
    },
    options: {
      plugins: { legend:{ display:false } },
      scales: {
        x: { ticks:{ color:'#777', font:{size:11} }, grid:{ color:'#2e2e2e' } },
        y: { min:0, max:100,
             ticks:{ color:'#777', font:{size:11}, callback: v => v+'%' },
             grid:{ color:'#2e2e2e' } }
      }
    }
  });

  // Recommendation
  document.getElementById('rec').style.display = 'block';
  document.getElementById('recBody').textContent = r.recommendation;
}
</script>
</body>
</html>
